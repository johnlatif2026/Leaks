<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - إدارة الأقسام</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0f2f5;
  margin: 0;
  padding: 0;
}
header {
  background: #343a40;
  color: #fff;
  padding: 15px;
  text-align: center;
}
.container {
  max-width: 900px;
  margin: 20px auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
input, textarea, select {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
}
button {
  padding: 12px 20px;
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { background: #0056b3; }
.section {
  border-bottom: 1px solid #ddd;
  padding: 10px 0;
}
.section:last-child { border: none; }
</style>
</head>
<body>
<header>
  <h1>لوحة التحكم</h1>
</header>
<div class="container">
<h2>إرسال إشعار</h2>
<textarea id="notifyMessage" placeholder="اكتب الرسالة هنا"></textarea>
<button id="sendNotify">إرسال</button>

<h2>إنشاء قسم جديد</h2>
<input type="text" id="sectionName" placeholder="اسم القسم">
<input type="text" id="sectionTitle" placeholder="العنوان">
<textarea id="sectionText" placeholder="النص"></textarea>
<input type="text" id="sectionImage" placeholder="رابط الصورة (اختياري)">
<button id="createSection">إنشاء</button>

<h2>الأقسام الحالية</h2>
<div id="sectionsContainer"></div>
<p id="status"></p>
</div>

<script>
const jwtToken = localStorage.getItem("jwt");
if(!jwtToken) window.location.href = "/login.html";

async function fetchSections() {
  try {
    const res = await fetch("/api/sections", {
      headers: { "Authorization": "Bearer " + jwtToken }
    });
    const data = await res.json();
    const container = document.getElementById("sectionsContainer");
    container.innerHTML = "";
    data.forEach(sec => {
      const div = document.createElement("div");
      div.className = "section";
      div.innerHTML = `<strong>${sec.title}</strong><p>${sec.text}</p>${sec.image ? `<img src="${sec.image}" width="100%">` : ""}`;
      container.appendChild(div);
    });
  } catch(err) {
    console.error(err);
  }
}

document.getElementById("sendNotify").addEventListener("click", async () => {
  const msg = document.getElementById("notifyMessage").value.trim();
  if(!msg) return alert("اكتب الرسالة");
  const res = await fetch("/api/notify", {
    method: "POST",
    headers: { "Content-Type":"application/json", "Authorization": "Bearer "+jwtToken },
    body: JSON.stringify({ message: msg })
  });
  const data = await res.json();
  document.getElementById("status").innerText = res.ok ? "تم الإرسال ✅" : data.error;
  document.getElementById("notifyMessage").value="";
});

document.getElementById("createSection").addEventListener("click", async () => {
  const name = document.getElementById("sectionName").value.trim();
  const title = document.getElementById("sectionTitle").value.trim();
  const text = document.getElementById("sectionText").value.trim();
  const image = document.getElementById("sectionImage").value.trim();
  if(!name || !title || !text) return alert("اكمل كل الحقول المطلوبة");
  
  const res = await fetch("/api/section", {
    method: "POST",
    headers: { "Content-Type":"application/json", "Authorization": "Bearer "+jwtToken },
    body: JSON.stringify({ name, title, text, image })
  });
  const data = await res.json();
  if(res.ok){
    document.getElementById("status").innerText="تم إنشاء القسم ✅";
    document.getElementById("sectionName").value="";
    document.getElementById("sectionTitle").value="";
    document.getElementById("sectionText").value="";
    document.getElementById("sectionImage").value="";
    fetchSections();
  }else{
    document.getElementById("status").innerText = data.error;
  }
});

// initial fetch
fetchSections();
</script>
</body>
</html>
