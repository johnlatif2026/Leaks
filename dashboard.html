<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>الداشبورد</title>
<style>
  body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; background: #f7f7f7; }
input, button { margin: 5px 0; padding: 8px; }
button { cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px; }
h1, h2 { color: #333; }
ul { list-style-type: none; padding: 0; }
li { background: #fff; margin: 5px 0; padding: 10px; border-radius: 4px; }
</style>
</head>
<body>
  <h1>الداشبورد</h1>

  <h2>إرسال رسالة</h2>
  <input type="text" id="message" placeholder="اكتب الرسالة">
  <button id="sendMsg">إرسال</button>

  <h2>إنشاء قسم</h2>
  <input type="text" id="sectionName" placeholder="اسم القسم">
  <input type="text" id="title" placeholder="العنوان">
  <input type="text" id="text" placeholder="النص">
  <input type="text" id="image" placeholder="رابط الصورة (اختياري)">
  <button id="createSection">إنشاء</button>

  <h2>الأقسام الحالية</h2>
  <ul id="sectionsList"></ul>

<script>
const token = localStorage.getItem("jwt");
if (!token) {
  alert("سجل الدخول أولا");
  window.location.href = "/login";
}

// إرسال رسالة عبر Telegram
document.getElementById("sendMsg").addEventListener("click", async () => {
  const msg = document.getElementById("message").value;
  if (!msg) return alert("اكتب الرسالة");

  try {
    const res = await fetch("/api/notify", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    alert("تم الإرسال!");
  } catch (err) {
    console.error(err);
    alert("خطأ في الإرسال");
  }
});

// إنشاء قسم جديد
document.getElementById("createSection").addEventListener("click", async () => {
  const name = document.getElementById("sectionName").value;
  const title = document.getElementById("title").value;
  const text = document.getElementById("text").value;
  const image = document.getElementById("image").value;

  if (!name || !title || !text) return alert("اكمل جميع الحقول المطلوبة");

  try {
    const res = await fetch("/api/section", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ name, title, text, image })
    });
    const data = await res.json();
    alert("تم إنشاء القسم!");
    loadSections();
  } catch (err) {
    console.error(err);
    alert("خطأ في إنشاء القسم");
  }
});

// تحميل الأقسام الحالية
async function loadSections() {
  try {
    const res = await fetch("/api/sections", {
      headers: { "Authorization": "Bearer " + token }
    });
    const sections = await res.json();
    const ul = document.getElementById("sectionsList");
    ul.innerHTML = "";
    sections.forEach(sec => {
      const li = document.createElement("li");
      li.textContent = `[${sec.collection}] ${sec.title}: ${sec.text}`;
      ul.appendChild(li);
    });
  } catch (err) {
    console.error(err);
  }
}

loadSections();
</script>
</body>
</html>
